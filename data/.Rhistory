dend <- as.dendrogram(cwar)
View(dend)
ape::write.tree(dend file='PULs343_ward.tree')
ape::write.tree(dend,file='PULs343_ward.tree')
dend <- as.dendrogram(cwar)
phy <- as.phylo(dend)
dend <- as.dendrogram(cwar)
phy <- ape::as.phylo(dend)
ape::as.phylo()
phy <- ape::as.phylo(cwar)
ape::write.tree(phy = phy,file='PULs343_ward.tree')
## Extract the counts
all.puls <- get.puls(mags = MAGS.arr)
View(all.puls)
all.puls <- merge(all.puls,MAGS.meta,
by = "mag", all.x = TRUE)
View(all.puls)
## Create the matrix
mtx <- all.puls %>%
spread(pul, frequency) %>%
column_to_rownames('Class') %>%
as.matrix() %>%
replace(is.na(.), 0)
all.puls <- get.puls(mags = MAGS.arr)
all.puls <- merge(all.puls,MAGS.meta,
by = "mag", all.x = TRUE)
## Create the matrix
mtx <- all.puls %>%
spread(pul, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
mtx <- mtx / 10
View(mtx)
all.puls <- get.puls(mags = MAGS.arr)
# all.puls <- merge(all.puls,MAGS.meta,
#                   by = "mag", all.x = TRUE)
## Create the matrix
mtx <- all.puls %>%
spread(pul, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
mtx <- mtx / 10
mtx <- as.dist(mtx)
View(cwar)
cwar[["labels"]]
View(phy)
phy[["tip.label"]]
## Modify labels
clust.order <- phy[["tip.label"]]
MAGS.ordered <- MAGS.meta[match(clust.order,MAGS.meta$mag),]
View(MAGS.ordered)
all.puls <- get.puls(mags = MAGS.arr)
# all.puls <- merge(all.puls,MAGS.meta,
#                   by = "mag", all.x = TRUE)
## Create the matrix
mtx <- all.puls %>%
spread(pul, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
mtx <- mtx / 10
mtx <- as.dist(mtx)
#build the dendogram
cwar <- hclust(dist(mtx, method = "euclidean"), method = "ward.D2")
phy <- ape::as.phylo(cwar)
## Modify labels
clust.order <- phy[["tip.label"]]
MAGS.ordered <- MAGS.meta[match(clust.order,MAGS.meta$mag),]
phy[["tip.label"]] <- c(MAGS.ordered$Class)
ape::write.tree(phy = phy,file='PULs343_ward_Class.tree')
View(MAGS.ordered)
write.table(MAGS.ordered,file = "343_MAGS_metadata.tsv",quote = FALSE,col.names = TRUE,row.names = TRUE,sep = "\t")
## Libraries
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(pheatmap))
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(textshape))
suppressPackageStartupMessages(library(stringr))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(vegan))
all.puls <- get.puls(mags = MAGS.arr)
# all.puls <- merge(all.puls,MAGS.meta,
#                   by = "mag", all.x = TRUE)
## Create the matrix
mtx <- all.puls %>%
spread(pul, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
mtx <- vegdist(mtx,"bray")
#build the dendogram
cwar <- hclust(dist(mtx, method = "euclidean"), method = "ward.D2")
phy <- ape::as.phylo(cwar)
ape::write.tree(phy = phy,file='PULs343_ward_Class.tree')
View(MAGS.ordered)
install.packages("dendextend")
install.packages("circlize")
unique(MAGS.meta$Class)
all.puls <- get.puls(mags = MAGS.arr)
# all.puls <- merge(all.puls,MAGS.meta,
#                   by = "mag", all.x = TRUE)
## Create the matrix
mtx <- all.puls %>%
spread(pul, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
mtx <- vegdist(mtx,"bray")
## build the dendogram
cwar <- hclust(dist(mtx, method = "euclidean"), method = "ward.D2")
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6)
suppressPackageStartupMessages(library(dendextend))
suppressPackageStartupMessages(library(circlize))
dend <- dend %>%
color_branches(k = 6)
# hc <- color_branches(hc, k = 4)
# Dendrograma de colores
circlize_dendrogram(dend,
labels_track_height = NA,
dend_track_height = 0.5)
dend <- dend %>%
color_branches(k = 6)
# Dendrograma de colores
circlize_dendrogram(dend)
circlize_dendrogram(dend,
dend_track_height = 0.5)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 300)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.5)
dev.off()
png(filename = "dend.test.png",width = 3000,height = 3000,res = 50)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.5)
dev.off()
png(filename = "dend.test.png",width = 3000,height = 3000,res = 100)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.5)
dev.off()
png(filename = "dend.test.png",width = 3000,height = 3000,res = 70)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.5)
dev.off()
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.2)
dev.off()
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.9)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.8)
dev.off()
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.1)
dev.off()
View(dend)
dend[[2]]
dend[[1]]
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 1)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.5)
dev.off()
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (2)
# hc <- color_branches(hc, k = 4)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (5)
# hc <- color_branches(hc, k = 4)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (100)
# hc <- color_branches(hc, k = 4)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (30)
# hc <- color_branches(hc, k = 4)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (30) %>%
rank_branches(diff_height = 10)
# hc <- color_branches(hc, k = 4)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (30) %>%
set("branches_k_color", value = "black")
# hc <- color_branches(hc, k = 4)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (30) %>%
hang.dendrogram()
# hc <- color_branches(hc, k = 4)
png(filename = "dend.test.png",width = 3000,height = 3000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (30) %>%
hang.dendrogram()
# hc <- color_branches(hc, k = 4)
png(filename = "dend.test.png",width = 2000,height = 2000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
ggplot(dend, labels = FALSE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
View(dend)
dend[[1]]
dend[[2]]
dend$height
dend$height <- 0.1
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (30) %>%
hang.dendrogram()
# hc <- color_branches(hc, k = 4)
ggplot(dend, labels = FALSE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
png(filename = "dend.test.png",width = 2000,height = 2000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
dend_track_height = 0.4)
dev.off()
View(dend)
dend$height <- 1
ggplot(dend, labels = FALSE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (30) %>%
hang.dendrogram()
# hc <- color_branches(hc, k = 4)
ggplot(dend, labels = FALSE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (15) %>%
hang.dendrogram()
# hc <- color_branches(hc, k = 4)
ggplot(dend, labels = FALSE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
fviz_dend(dend, cex = 0.5, k = 6,
color_labels_by_k = TRUE, rect = TRUE)
ape::fviz_dend(dend, cex = 0.5, k = 6,
color_labels_by_k = TRUE, rect = TRUE)
factoextra::::fviz_dend(dend, cex = 0.5, k = 6,
factoextra::fviz_dend(dend, cex = 0.5, k = 6,
color_labels_by_k = TRUE, rect = TRUE)
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 6) %>%
raise.dendrogram (15) %>%
hang.dendrogram()
# hc <- color_branches(hc, k = 4)
ggplot(dend, labels = FALSE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
factoextra::fviz_dend(dend, cex = 0.5, k = 6,
color_labels_by_k = TRUE, rect = TRUE)
png(filename = "dend.test.png",width = 2000,height = 2000,res = 60)
# Dendrograma de colores
circlize_dendrogram(dend,
labels_track_height = NA,
dend_track_height = 0.4)
dev.off()
length(unique(MAGS.ordered$Family))
factoextra::fviz_dend(dend, cex = 0.5, k = 19,
color_labels_by_k = TRUE, rect = TRUE)
dend <- as.dendrogram(cwar)
## Colors
dend <- dend %>%
color_branches(k = 19) %>%
raise.dendrogram (15) %>%
hang.dendrogram()
# hc <- color_branches(hc, k = 4)
ggplot(dend, labels = TRUE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
png(filename = "dend.test.png",width = 4000,height = 2000,res = 60)
factoextra::fviz_dend(dend, cex = 0.5, k = 19,
color_labels_by_k = TRUE, rect = TRUE)
dev.off()
png(filename = "dend.test.png",width = 4000,height = 2000,res = 100)
factoextra::fviz_dend(dend, cex = 0.5, k = 19,
color_labels_by_k = TRUE, rect = TRUE)
dev.off()
dend <- as.dendrogram(cwar)
dend[[1]]
## Colors
dend <- dend %>%
color_branches(k = 20) %>%
raise.dendrogram (15) %>%
hang.dendrogram()
factoextra::fviz_dend(dend, cex = 0.5, k = 20,
color_labels_by_k = TRUE, rect = TRUE)
source("~/.active-rstudio-document")
View(all.puls)
View(MAGS.meta)
MAGS.meta %>%
group_by(Family) %>%
summarize(counts = sum(PULS))
MAGS.meta %>%
group_by(Family) %>%
summarize()
MAGS.meta %>%
group_by(Family) %>%
summarize(counts = length(mag))
mtx <- vegdist(mtx,"bray")
all.puls <- get.puls(mags = MAGS.arr)
# all.puls <- merge(all.puls,MAGS.meta,
#                   by = "mag", all.x = TRUE)
## Create the matrix
mtx <- all.puls %>%
spread(pul, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
mtx <- vegdist(mtx,"bray")
dend <- as.dendrogram(hclust(vegdist(PULs,"bray")))
all.puls <- get.puls(mags = MAGS.arr)
# all.puls <- merge(all.puls,MAGS.meta,
#                   by = "mag", all.x = TRUE)
## Create the matrix
mtx <- all.puls %>%
spread(pul, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
#mtx <- vegdist(mtx,"bray")
dend <- as.dendrogram(hclust(vegdist(mtx,"bray")))
View(dend)
dend <- dend %>%
color_branches(k = 19) %>%
raise.dendrogram (15) %>%
hang.dendrogram()
View(dend)
ggplot(dend, labels = TRUE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
ggplot(dend, labels = FALSE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
factoextra::fviz_dend(dend, cex = 0.5, k = 20,
color_labels_by_k = TRUE, rect = TRUE)
phy <- ape::as.phylo(hclust(vegdist(mtx,"bray")))
ape::write.tree(phy = phy,file='PULs343_ward_Class.tree')
View(MAGS.meta)
View(MAGS.meta)
## FUNCTIONS
## EXTRACT CAZYMES
get.cazymes <- function(mags) {
all.cazys <- data.frame()
for (mag in mags) {
## Filter the 5 MAGs that do not have significant PULs associated with them
if (mag == "3300007500_43" || mag == "3300011404_8" || mag == "3300012067_9" || mag == "3300012151_17" || mag == "3300012165_16" || mag == "3300007500_43") {
next
}
df.temp <- read.table(file = paste(mag,"/output_dbcan4/",mag,".CAZyCounts.single.txt",sep = ""),sep = "\t",)
colnames(df.temp) <- c("cazy","frequency")
df.temp["mag"] <- mag
df.temp <- df.temp %>%
select(mag,cazy,everything())
## Create a dataframe with the nodes: mag = from, cazy = to, freq = value
all.cazys <- rbind(all.cazys,df.temp)
}
return(all.cazys)
}
all.puls <- get.puls(mags = MAGS.arr)
all.cazys <- get.cazymes(mags = MAGS.arr)
mtx <- all.cazys %>%
spread(pul, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
mtx <- all.cazys %>%
spread(cazy, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
#mtx <- vegdist(mtx,"bray")
dend <- as.dendrogram(hclust(vegdist(mtx,"bray")))
dend <- dend %>%
color_branches(k = 19) %>%
raise.dendrogram (15) %>%
hang.dendrogram()
png(filename = "cazy.dend.test.png",width = 4000,height = 2000,res = 100)
factoextra::fviz_dend(dend, cex = 0.5, k = 20,
color_labels_by_k = TRUE, rect = TRUE)
dev.off()
phy <- ape::as.phylo(hclust(vegdist(mtx,"bray")))
ape::write.tree(phy = phy,file='CAZy343_ward_Class.tree')
3300029682 12
3300029754 18
3300028418 10
3300024043 10
View(all.puls)
all.cazys <- get.cazymes(mags = MAGS.arr)
## Create the matrix
mtx <- all.cazys %>%
spread(cazy, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
#mtx <- vegdist(mtx,"bray")
dend <- as.dendrogram(hclust(vegdist(mtx,"bray")))
## Colors
dend <- dend %>%
color_branches(k = 19) %>%
raise.dendrogram (15) %>%
hang.dendrogram()
## Control quality plot
ggplot(dend, labels = FALSE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
png(filename = "CAZy_dend_test.png",width = 4000,height = 2000,res = 100)
factoextra::fviz_dend(dend, cex = 0.5, k = 20,
color_labels_by_k = TRUE, rect = TRUE)
dev.off()
## Write the tree
phy <- ape::as.phylo(hclust(vegdist(mtx,"bray")))
ape::write.tree(phy = phy,file='CAZy343_ward_Class.tree')
## Repeat the whole process with PULs
all.puls <- get.puls(mags = MAGS.arr)
## Create the matrix
mtx <- all.puls %>%
spread(pul, frequency) %>%
column_to_rownames('mag') %>%
as.matrix() %>%
replace(is.na(.), 0)
#mtx <- vegdist(mtx,"bray")
dend <- as.dendrogram(hclust(vegdist(mtx,"bray")))
## Colors
dend <- dend %>%
color_branches(k = 19) %>%
raise.dendrogram (15) %>%
hang.dendrogram()
## Control quality plot
ggplot(dend, labels = FALSE) + scale_y_reverse(expand = c(0.2, 0)) + coord_polar(theta="x")
png(filename = "PULs_dend_test.png",width = 4000,height = 2000,res = 100)
factoextra::fviz_dend(dend, cex = 0.5, k = 20,
color_labels_by_k = TRUE, rect = TRUE)
dev.off()
## Write the tree
phy <- ape::as.phylo(hclust(vegdist(mtx,"bray")))
ape::write.tree(phy = phy,file='PULs343_ward_Class.tree')
